(function(){"use strict";var t={698:function(t,e,o){var i=o(2856),s=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},a=[],r=o(1656),n={},l=(0,r.A)(n,s,a,!1,null,null,null),c=l.exports,d=o(1594),h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home"},[e("div",{staticClass:"room-controls"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.roomCode,expression:"roomCode"}],attrs:{placeholder:"방 코드 입력 (6자리)",maxlength:"6",pattern:"\\d*"},domProps:{value:t.roomCode},on:{input:[function(e){e.target.composing||(t.roomCode=e.target.value)},t.validateInput]}}),e("button",{attrs:{disabled:t.roomCode&&!t.isValidCode},on:{click:t.handleRoom}},[t._v(" "+t._s(t.isValidCode?"방 만들기/참여하기":"새로운 방 만들기")+" ")])]),t.error?e("div",{staticClass:"error-message"},[t._v(" "+t._s(t.error)+" ")]):t._e()])},u=[],m=(o(4114),o(417));const f=m.A.create({baseURL:"https://file2.schoolworks.dev/api",timeout:5e3,headers:{"Content-Type":"application/json"}});var p={name:"HomeView",data(){return{roomCode:"",error:""}},computed:{isValidCode(){return/^\d{6}$/.test(this.roomCode)}},methods:{validateInput(){this.roomCode=this.roomCode.replace(/[^\d]/g,"")},async handleRoom(){this.error="";try{if(this.roomCode){if(this.isValidCode){const t=await f.post("/rooms",{roomCode:this.roomCode});t.data&&t.data.roomCode&&(this.saveRecentRoom(t.data.roomCode),this.navigateToRoom(t.data.roomCode))}}else{const t=await f.post("/rooms");t.data&&t.data.roomCode&&(this.saveRecentRoom(t.data.roomCode),this.navigateToRoom(t.data.roomCode))}}catch(t){t.response?this.showError(t.response.data.message||"서버 오류가 발생했습니다."):t.request?this.showError("서버에 연결할 수 없습니다."):this.showError("알 수 없는 오류가 발생했습니다."),console.error("Error:",t)}},showError(t){this.error=t},saveRecentRoom(t){const e=JSON.parse(localStorage.getItem("recentRooms")||"[]");e.includes(t)||(e.unshift(t),e.length>5&&e.pop(),localStorage.setItem("recentRooms",JSON.stringify(e)))},navigateToRoom(t){this.$router.push(`/room/${t}`).catch((t=>{if("NavigationDuplicated"!==t.name)throw t}))}}},v=p,g=(0,r.A)(v,h,u,!1,null,"fc5c8956",null),C=g.exports,w=function(){var t=this,e=t._self._c;return e("div",{staticClass:"room"},[t.notification.show?e("div",{staticClass:"notification"},[t._v(" "+t._s(t.notification.message)+" ")]):t._e(),e("div",{staticClass:"room-header"},[e("h2",[t._v("방 코드: "+t._s(t.roomCode))]),e("div",{staticClass:"expiry-timer",class:{"expiry-warning":t.expiresIn<600}},[t._v(" 남은 시간: "+t._s(t.formatTime(t.expiresIn))+" ")])]),e("div",{staticClass:"room-content"},[e("div",{staticClass:"content-panel"},[e("div",{staticClass:"file-upload-section"},[e("h3",[t._v("파일 업로드")]),e("div",{staticClass:"upload-form"},[e("input",{ref:"fileInput",staticClass:"file-input",attrs:{type:"file"},on:{change:t.handleFileChange}}),e("button",{staticClass:"upload-button",attrs:{disabled:!t.selectedFile||t.isUploading},on:{click:t.uploadFile}},[t._v(" "+t._s(t.isUploading?"업로드 중...":"업로드")+" ")])]),t.uploadError?e("div",{staticClass:"error-message"},[t._v(" "+t._s(t.uploadError)+" ")]):t._e(),t.uploadSuccess?e("div",{staticClass:"success-message"},[t._v(" "+t._s(t.uploadSuccess)+" ")]):t._e()]),e("div",{staticClass:"file-list-section"},[t.isLoading?e("div",{staticClass:"loading-message"},[t._v(" 파일 목록을 불러오는 중... ")]):0===t.files.length?e("div",{staticClass:"empty-message"},[t._v(" 공유된 파일이 없습니다. ")]):e("ul",{staticClass:"file-list"},t._l(t.files,(function(o){return e("li",{key:o._uniqueKey||t.generateUUID(),staticClass:"file-item",class:{"is-office-document":o.isOfficeDocument,"is-selected":t.selectedDocument&&t.selectedDocument.filename===o.filename}},[e("div",{staticClass:"file-info"},[e("span",{staticClass:"file-name"},[t._v(t._s(o.originalName))]),e("span",{staticClass:"file-size"},[t._v(t._s(t.formatFileSize(o.size)))]),e("span",{staticClass:"file-date"},[t._v(t._s(t.formatDate(o.uploadedAt)))]),o.viewCount>0?e("span",{staticClass:"view-count"},[t._v(t._s(o.viewCount)+" 명 보는 중")]):t._e()]),e("div",{staticClass:"file-actions"},[e("button",{staticClass:"download-button",on:{click:function(e){return t.downloadFile(o)}}},[t._v(" 다운로드 ")]),e("button",{staticClass:"delete-button",on:{click:function(e){return t.deleteFile(o)}}},[t._v(" 삭제 ")])])])})),0)])])])])},y=[],x=(o(8111),o(7588),o(1701),o(4603),o(7566),o(8721),o(5034));function _(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0,o="x"===t?e:3&e|8;return o.toString(16)}))}var b={name:"RoomView",data(){return{roomCode:this.$route.params.roomId,expiresIn:3600,timerInterval:null,apiUrl:"https://file2.schoolworks.dev",socketUrl:"https://file2.schoolworks.dev",socket:null,selectedFile:null,isUploading:!1,uploadError:"",uploadSuccess:"",files:[],isLoading:!1,userId:`user_${Date.now()}_${Math.floor(1e3*Math.random())}`,hasJoinedRoom:!1,notification:{show:!1,message:"",timeout:null}}},async created(){try{await this.joinOrCreateRoom(),this.startExpiryTimer(),this.loadFiles(),this.connectSocket()}catch(t){console.error("방 참여 오류:",t),this.navigateToHome()}},beforeDestroy(){this.timerInterval&&clearInterval(this.timerInterval),this.socket&&this.socket.disconnect()},methods:{async joinOrCreateRoom(){try{const t=await m.A.post(`${this.apiUrl}/api/rooms/${this.roomCode}`);this.expiresIn=t.data.expiresIn||3600,this.hasJoinedRoom||(this.showNotification("방에 성공적으로 참여했습니다."),this.hasJoinedRoom=!0)}catch(t){if(!t.response||404!==t.response.status)throw t;if(!/^\d{6}$/.test(this.roomCode))throw t;try{const t=await m.A.post(`${this.apiUrl}/api/rooms`,{roomCode:this.roomCode});this.expiresIn=t.data.expiresIn||3600,this.showNotification("새 방이 생성되었습니다."),this.hasJoinedRoom=!0}catch(e){throw console.error("방 생성 오류:",e),e}}},async checkRoomStatus(){try{const t=await m.A.get(`${this.apiUrl}/api/rooms/${this.roomCode}/status`);if(!t.data.active)return this.navigateToHome(),void alert("방이 만료되었습니다.");this.expiresIn=t.data.expiresIn}catch(t){console.error("방 상태 확인 실패:",t),this.navigateToHome()}},navigateToHome(){this.$router.push("/").catch((t=>{if("NavigationDuplicated"!==t.name)throw t}))},startExpiryTimer(){this.timerInterval=setInterval((()=>{this.expiresIn--,this.expiresIn<=0?(clearInterval(this.timerInterval),this.navigateToHome(),alert("방이 만료되었습니다.")):this.expiresIn%60===0&&this.checkRoomStatus()}),1e3)},formatTime(t){const e=Math.floor(t/3600),o=Math.floor(t%3600/60),i=t%60;return`${e}:${String(o).padStart(2,"0")}:${String(i).padStart(2,"0")}`},handleFileChange(t){this.selectedFile=t.target.files[0]||null,this.uploadError="",this.uploadSuccess=""},async uploadFile(){if(!this.selectedFile)return void(this.uploadError="업로드할 파일을 선택해주세요.");this.isUploading=!0,this.uploadError="",this.uploadSuccess="";const t=new FormData;t.append("file",this.selectedFile);try{const e=await m.A.post(`${this.apiUrl}/api/rooms/${this.roomCode}/files`,t,{headers:{"Content-Type":"multipart/form-data"}});this.uploadSuccess=e.data.message||"파일이 성공적으로 업로드되었습니다.",this.selectedFile=null,this.$refs.fileInput.value="",this.loadFiles()}catch(e){console.error("파일 업로드 오류:",e),this.uploadError=e.response?.data?.message||"파일 업로드에 실패했습니다."}finally{this.isUploading=!1}},async loadFiles(){this.isLoading=!0;try{const t=await m.A.get(`${this.apiUrl}/api/rooms/${this.roomCode}/files`),e=t.data.files||[],o=new Map;e.forEach((t=>{(!o.has(t.filename)||t.uploadedAt>o.get(t.filename).uploadedAt)&&o.set(t.filename,t)}));const i=Array.from(o.values());this.files=i.map((t=>({...t,_uniqueKey:_()})))}catch(t){console.error("파일 목록 로드 오류:",t),this.files=[]}finally{this.isLoading=!1}},async downloadFile(t){try{const e=`${this.apiUrl}/api/rooms/${this.roomCode}/files/download/${t.id}?download=true`,o=await(0,m.A)({url:e,method:"GET",responseType:"blob"}),i=new Blob([o.data],{type:t.mimetype}),s=window.URL.createObjectURL(i),a=document.createElement("a");a.href=s,a.setAttribute("download",t.originalName),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a)}catch(e){console.error("파일 다운로드 오류:",e),this.showNotification("파일 다운로드에 실패했습니다.")}},async deleteFile(t){if(confirm(`파일 "${t.originalName}"을(를) 삭제하시겠습니까?`))try{const e=await m.A.delete(`${this.apiUrl}/api/rooms/${this.roomCode}/files/${t.id}`),o=this.files.findIndex((e=>e.id===t.id));-1!==o&&this.files.splice(o,1),this.showNotification(e.data.message||"파일이 삭제되었습니다.")}catch(e){console.error("파일 삭제 오류:",e),this.showNotification("파일 삭제에 실패했습니다.")}},showNotification(t,e=3e3){this.notification.timeout&&clearTimeout(this.notification.timeout),this.notification.message=t,this.notification.show=!0,this.notification.timeout=setTimeout((()=>{this.notification.show=!1}),e)},formatFileSize(t){if(0===t)return"0 Bytes";const e=1024,o=["Bytes","KB","MB","GB","TB"],i=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,i)).toFixed(2))+" "+o[i]},formatDate(t){const e=new Date(t);return e.toLocaleString()},connectSocket(){this.socket=(0,x.Ay)(this.socketUrl),this.socket.on("connect",(()=>{console.log("Socket.IO 연결 성공"),this.socket.emit("joinRoom",this.roomCode)})),this.socket.on("fileUploaded",(t=>{console.log("새 파일 업로드 알림 수신:",t);const e={...t.file,_uniqueKey:_()},o=this.files.findIndex((t=>t.filename===e.filename));-1!==o?(e._uniqueKey=this.files[o]._uniqueKey,this.files.splice(o,1,e)):this.files.push(e),this.files.sort(((t,e)=>e.uploadedAt-t.uploadedAt))})),this.socket.on("fileDeleted",(t=>{console.log("파일 삭제 알림 수신:",t);const e=this.files.findIndex((e=>e.id&&e.id===t.id||e.filename===t.filename));-1!==e&&(this.files.splice(e,1),this.showNotification("파일이 삭제되었습니다."))})),this.socket.on("connect_error",(t=>{console.error("Socket.IO 연결 오류:",t)}))}}},I=b,k=(0,r.A)(I,w,y,!1,null,"7f6351f6",null),R=k.exports;i.Ay.use(d.Ay);const S=[{path:"/",name:"HomeView",component:C},{path:"/room/:roomId",name:"RoomView",component:R},{path:"/:roomId(\\d{6})",name:"DirectRoomView",component:R}],$=new d.Ay({mode:"history",base:"/",routes:S});var A=$,T=o(1910);i.Ay.use(T.Ay);var F=new T.Ay.Store({state:{},getters:{},mutations:{},actions:{},modules:{}});i.Ay.config.productionTip=!1,new i.Ay({router:A,store:F,render:t=>t(c)}).$mount("#app")}},e={};function o(i){var s=e[i];if(void 0!==s)return s.exports;var a=e[i]={exports:{}};return t[i].call(a.exports,a,a.exports,o),a.exports}o.m=t,function(){var t=[];o.O=function(e,i,s,a){if(!i){var r=1/0;for(d=0;d<t.length;d++){i=t[d][0],s=t[d][1],a=t[d][2];for(var n=!0,l=0;l<i.length;l++)(!1&a||r>=a)&&Object.keys(o.O).every((function(t){return o.O[t](i[l])}))?i.splice(l--,1):(n=!1,a<r&&(r=a));if(n){t.splice(d--,1);var c=s();void 0!==c&&(e=c)}}return e}a=a||0;for(var d=t.length;d>0&&t[d-1][2]>a;d--)t[d]=t[d-1];t[d]=[i,s,a]}}(),function(){o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,{a:e}),e}}(),function(){o.d=function(t,e){for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={524:0};o.O.j=function(e){return 0===t[e]};var e=function(e,i){var s,a,r=i[0],n=i[1],l=i[2],c=0;if(r.some((function(e){return 0!==t[e]}))){for(s in n)o.o(n,s)&&(o.m[s]=n[s]);if(l)var d=l(o)}for(e&&e(i);c<r.length;c++)a=r[c],o.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return o.O(d)},i=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=o.O(void 0,[504],(function(){return o(698)}));i=o.O(i)})();
//# sourceMappingURL=app.144416d3.js.map