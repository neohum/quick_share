(function(){"use strict";var e={8730:function(e,t,i){var o=i(2856),s=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},a=[],r=i(1656),n={},l=(0,r.A)(n,s,a,!1,null,null,null),c=l.exports,d=i(1594),h=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("div",{staticClass:"container"},[t("h1",{staticClass:"title"},[e._v("Quick Share")]),t("div",{staticClass:"room-controls"},[t("div",{staticClass:"input-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.roomCode,expression:"roomCode"}],attrs:{placeholder:"방 코드 입력 (6자리)",maxlength:"6",pattern:"\\d*"},domProps:{value:e.roomCode},on:{input:[function(t){t.target.composing||(e.roomCode=t.target.value)},e.validateInput]}})]),t("div",{staticClass:"button-group"},[t("button",{attrs:{disabled:e.roomCode&&!e.isValidCode},on:{click:e.createRoom}},[e._v(" "+e._s(e.roomCode?"새 방 만들기":"자동 코드로 방 만들기")+" ")])])]),t("div",{staticClass:"room-join"},[t("h2",{staticClass:"section-title"},[e._v("기존 방 들어가기")]),t("div",{staticClass:"input-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.joinRoomCode,expression:"joinRoomCode"}],attrs:{placeholder:"참여할 방 코드 입력",maxlength:"6",pattern:"\\d*"},domProps:{value:e.joinRoomCode},on:{input:[function(t){t.target.composing||(e.joinRoomCode=t.target.value)},e.validateJoinInput]}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.joinUserName,expression:"joinUserName"}],attrs:{placeholder:"이름 입력",maxlength:"20"},domProps:{value:e.joinUserName},on:{input:function(t){t.target.composing||(e.joinUserName=t.target.value)}}})]),t("button",{attrs:{disabled:!e.isValidJoinCode||!e.joinUserName},on:{click:e.joinRoom}},[e._v(" 방 들어가기 ")])]),e.error?t("div",{staticClass:"error-message"},[e._v(" "+e._s(e.error)+" ")]):e._e(),e.isLoading?t("div",{staticClass:"loading-indicator"},[e._v(" 처리 중... ")]):e._e()])])},m=[],p=(i(4114),i(417));const u=p.A.create({baseURL:"http://localhost:3001/api",timeout:5e3,headers:{"Content-Type":"application/json"}});u.interceptors.request.use((e=>(console.log("API 요청:",e.method,e.url,e.data),e))),u.interceptors.response.use((e=>(console.log("API 응답 성공:",e.status,e.data),e)),(e=>(console.error("API 응답 오류:",e.response?`${e.response.status} ${JSON.stringify(e.response.data)}`:e.message),Promise.reject(e))));var f={name:"HomeView",data(){return{roomCode:"",joinRoomCode:"",joinUserName:"",error:"",isLoading:!1}},created(){const e=localStorage.getItem("userName");e&&(this.joinUserName=e)},computed:{isValidCode(){return/^\d{6}$/.test(this.roomCode)},isValidJoinCode(){return/^\d{6}$/.test(this.joinRoomCode)}},methods:{validateInput(){this.roomCode=this.roomCode.replace(/[^\d]/g,"")},validateJoinInput(){this.joinRoomCode=this.joinRoomCode.replace(/[^\d]/g,"")},async createRoom(){if(!this.isLoading){this.error="",this.isLoading=!0;try{const e={};this.roomCode&&this.isValidCode&&(e.roomCode=this.roomCode);const t=await u.post("/rooms",e);t.data&&t.data.roomCode&&(this.saveRecentRoom(t.data.roomCode),this.navigateToRoom(t.data.roomCode))}catch(e){e.response&&409===e.response.status?this.showError("이미 존재하는 방 코드입니다. 다른 코드를 입력해주세요."):e.response?this.showError(e.response.data.message||"서버 오류가 발생했습니다."):e.request?this.showError("서버에 연결할 수 없습니다."):this.showError("알 수 없는 오류가 발생했습니다."),console.error("Error:",e)}finally{this.isLoading=!1}}},async joinRoom(){if(this.isValidJoinCode)if(this.joinUserName.trim()){if(!this.isLoading){this.error="",this.isLoading=!0,localStorage.setItem("userName",this.joinUserName);try{const e=await u.post(`/rooms/${this.joinRoomCode}`,{userName:this.joinUserName});e.data&&(this.saveRecentRoom(this.joinRoomCode),this.$router.push({path:`/room/${this.joinRoomCode}`,query:{userName:this.joinUserName}}))}catch(e){console.error("방 참여 오류:",e),e.response&&404===e.response.status?this.showError("존재하지 않는 방입니다."):e.response?this.showError(e.response.data.message||"서버 오류가 발생했습니다."):e.request?this.showError("서버에 연결할 수 없습니다."):this.showError("알 수 없는 오류가 발생했습니다.")}finally{this.isLoading=!1}}}else this.showError("이름을 입력해주세요");else this.showError("유효한 방 코드를 입력해주세요 (6자리 숫자)")},showError(e){this.error=e},saveRecentRoom(e){const t=JSON.parse(localStorage.getItem("recentRooms")||"[]");t.includes(e)||(t.unshift(e),t.length>5&&t.pop(),localStorage.setItem("recentRooms",JSON.stringify(t)))},navigateToRoom(e){this.$router.push({path:`/room/${e}`,query:this.joinUserName?{userName:this.joinUserName}:void 0}).catch((e=>{if("NavigationDuplicated"!==e.name)throw e}))}}},v=f,g=(0,r.A)(v,h,m,!1,null,"a7cab6cc",null),w=g.exports,C=function(){var e=this,t=e._self._c;return t("div",{staticClass:"room"},[e.notification.show?t("div",{staticClass:"notification",class:{"error-notification":e.notification.isError}},[e._v(" "+e._s(e.notification.message)+" ")]):e._e(),t("div",{staticClass:"room-header"},[t("div",{staticClass:"room-info"},[t("div",{staticClass:"room-code-container"},[t("h2",[e._v("방 코드: "+e._s(e.roomCode))]),t("div",{staticClass:"room-buttons"},[t("button",{staticClass:"qr-code-button",on:{click:function(t){return e.showQrCode()}}},[e._v(" QR코드 보기 ")]),t("button",{staticClass:"home-button",on:{click:function(t){return e.navigateToHome()}}},[e._v(" 홈으로 ")])])])]),t("div",{staticClass:"expiry-timer",class:{"expiry-warning":e.expiresIn<600}},[e._v(" 남은 시간: "+e._s(e.formatTime(e.expiresIn))+" ")])]),e.showQrUserNameModal?t("div",{staticClass:"qr-username-modal"},[t("div",{staticClass:"qr-username-content"},[t("h3",[e._v("환영합니다!")]),t("p",[e._v("QR 코드를 통해 방에 참여하셨습니다. 사용자 이름을 입력해주세요.")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.qrUserName,expression:"qrUserName"}],ref:"qrUserNameInput",staticClass:"qr-username-input",attrs:{placeholder:"사용자 이름 입력"},domProps:{value:e.qrUserName},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.saveQrUserName.apply(null,arguments)},input:function(t){t.target.composing||(e.qrUserName=t.target.value)}}}),t("button",{staticClass:"qr-username-button",on:{click:e.saveQrUserName}},[e._v("확인")])])]):e._e(),t("div",{staticClass:"room-content"},[t("div",{staticClass:"content-panel"},[t("div",{staticClass:"file-upload-section"},[t("h3",[e._v("파일 업로드")]),t("div",{staticClass:"drop-zone-container"},[t("div",{staticClass:"drop-zone",class:{"drop-zone-active":e.isDragging},on:{dragover:function(t){return t.preventDefault(),e.onDragOver.apply(null,arguments)},dragleave:function(t){return t.preventDefault(),e.onDragLeave.apply(null,arguments)},drop:function(t){return t.preventDefault(),e.onDrop.apply(null,arguments)},click:e.openFilePicker}},[t("div",{staticClass:"drop-zone-content"},[e.isUploading?t("div",{staticClass:"upload-progress-container"},[t("div",{staticClass:"upload-progress-bar",style:{width:e.uploadProgress+"%"}}),t("div",{staticClass:"upload-progress-text"},[e._v(e._s(e.uploadProgress)+"% 업로드 중...")])]):t("div",[t("div",{staticClass:"drop-icon"},[e._v("📤")]),t("p",[e._v("파일을 드래그하거나 클릭하세요")]),t("p",{staticStyle:{"font-size":"12px",color:"#666","margin-top":"5px"}},[e._v("자동으로 업로드됩니다")])]),t("input",{ref:"fileInput",staticClass:"file-input",staticStyle:{display:"none"},attrs:{type:"file",id:"fileInput",accept:"*/*"},on:{change:e.handleFileChange,click:function(e){e.stopPropagation()}}})]),e.selectedFile&&!e.isUploading?t("div",{staticClass:"selected-file"},[t("span",{staticClass:"selected-file-name"},[e._v(e._s(e.selectedFile.name))]),t("button",{staticClass:"clear-file-button",on:{click:function(t){return t.stopPropagation(),e.clearSelectedFile.apply(null,arguments)}}},[e._v("✕")])]):e._e()])])]),t("div",{staticClass:"file-list-section"},[t("div",{staticClass:"file-list-header"},[t("h3",[e._v("파일 목록")]),e.files.length>0?t("button",{staticClass:"download-all-button",class:{downloading:e.isDownloadingAll},attrs:{disabled:e.isDownloadingAll},on:{click:e.downloadAllFiles}},[t("span",{staticClass:"button-text"},[e._v(e._s(e.isDownloadingAll?"다운로드 중...":"전체 파일 다운로드"))]),e.isDownloadingAll?t("span",{staticClass:"loading-spinner"}):e._e()]):e._e()]),e.isLoading?t("div",{staticClass:"loading-message"},[e._v(" 파일 목록을 불러오는 중... ")]):0===e.files.length?t("div",{staticClass:"empty-message"},[e._v(" 공유된 파일이 없습니다. ")]):t("ul",{staticClass:"file-list"},e._l(e.files,(function(i){return t("li",{key:i._uniqueKey||e.generateUUID(),staticClass:"file-item",class:{"is-office-document":i.isOfficeDocument,"is-selected":e.selectedDocument&&e.selectedDocument.filename===i.filename}},[t("div",{staticClass:"file-info"},[t("div",{staticClass:"file-header"},[t("span",{staticClass:"file-name"},[e._v(e._s(i.originalName))]),t("span",{staticClass:"file-uploader"},[t("span",{staticClass:"uploader-label"},[e._v("업로더:")]),t("span",{staticClass:"uploader-name",class:{"my-upload":i.userName===e.userName}},[e._v(" "+e._s(i.userName||"익명")+" "),i.userName===e.userName?t("span",{staticClass:"my-upload-badge"},[e._v("(내 파일)")]):e._e()])])]),t("div",{staticClass:"file-details"},[t("span",{staticClass:"file-size"},[e._v(e._s(e.formatFileSize(i.size)))]),t("span",{staticClass:"file-date"},[e._v(e._s(e.formatDate(i.uploadedAt)))]),i.expiresAt?t("span",{staticClass:"file-expiry",class:{"expiry-soon":e.isExpiringSoon(i)}},[e._v(" 만료: "+e._s(e.formatExpiryTime(i.expiresAt))+" ")]):e._e(),t("span",{staticClass:"debug-info",staticStyle:{display:"none"}},[e._v(e._s(JSON.stringify(i)))]),i.viewCount>0?t("span",{staticClass:"view-count"},[e._v(e._s(i.viewCount)+" 명 보는 중")]):e._e()])]),t("div",{staticClass:"file-actions"},[t("button",{staticClass:"preview-button",on:{click:function(t){return e.previewFile(i)}}},[e._v(" 미리보기 ")]),t("button",{staticClass:"download-button",on:{click:function(t){return e.downloadFile(i)}}},[e._v(" 다운로드 ")])])])})),0)])])]),e.showQrCodeModal?t("div",{staticClass:"qr-code-modal",on:{click:e.closeQrCodeModal}},[t("div",{staticClass:"qr-code-modal-content",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"qr-code-modal-header"},[t("h3",[e._v("QR 코드")]),t("button",{staticClass:"close-button",on:{click:e.closeQrCodeModal}},[e._v("×")])]),t("div",{staticClass:"qr-code-modal-body"},[t("div",{ref:"qrcodeLarge",staticClass:"qr-code-large"}),t("p",{staticClass:"qr-code-modal-text"},[e._v("이 QR 코드를 스캔하여 방에 참여하세요")]),t("p",{staticClass:"qr-code-modal-room"},[e._v("방 코드: "+e._s(e.roomCode))])])])]):e._e(),e.isSocketConnected?e._e():t("div",{staticClass:"connection-status-banner"},[e._m(0),t("div",{staticClass:"connection-status-text"},[e._v(" 서버와의 연결이 끊겼습니다. 재연결 중... ")])]),e.previewModal.show?t("div",{staticClass:"preview-modal",on:{click:e.closePreview}},[t("div",{staticClass:"preview-content",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"preview-header"},[t("h3",[e._v(e._s(e.previewModal.file?e.previewModal.file.originalName:"파일 미리보기"))]),t("button",{staticClass:"close-button",on:{click:e.closePreview}},[e._v("×")])]),t("div",{staticClass:"preview-body"},[e.previewModal.isLoading?t("div",{staticClass:"preview-loading"},[t("div",{staticClass:"loading-spinner"}),t("p",[e._v("미리보기 로딩 중...")])]):e.previewModal.file&&e.isImageFile(e.previewModal.file)?t("img",{staticClass:"preview-image",attrs:{src:e.previewModal.previewUrl,alt:"이미지 미리보기"}}):e.previewModal.file&&e.isPdfFile(e.previewModal.file)?t("iframe",{staticClass:"preview-pdf",attrs:{src:e.previewModal.previewUrl,frameborder:"0"}}):e.previewModal.file&&e.isExcelFile(e.previewModal.file)?t("iframe",{staticClass:"preview-excel",attrs:{src:e.previewModal.officeViewerUrl,frameborder:"0"}}):e.previewModal.file&&e.isOfficeFile(e.previewModal.file)?t("iframe",{staticClass:"preview-office",attrs:{src:e.previewModal.officeViewerUrl,frameborder:"0"}}):e.previewModal.file&&e.isVideoFile(e.previewModal.file)?t("video",{staticClass:"preview-video",attrs:{src:e.previewModal.previewUrl,controls:""}}):e.previewModal.file&&e.isAudioFile(e.previewModal.file)?t("audio",{staticClass:"preview-audio",attrs:{src:e.previewModal.previewUrl,controls:""}}):e.previewModal.file&&e.isTextFile(e.previewModal.file)&&e.previewModal.textContent?t("div",{staticClass:"preview-text"},[t("pre",[e._v(e._s(e.previewModal.textContent))])]):t("div",{staticClass:"preview-unsupported"},[t("div",{staticClass:"unsupported-icon"},[e._v("📄")]),t("p",[e._v("이 파일 형식은 미리보기를 지원하지 않습니다.")]),t("button",{staticClass:"download-button",on:{click:function(t){return e.downloadFile(e.previewModal.file)}}},[e._v(" 다운로드 ")])])])])]):e._e()])},N=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"connection-status-icon"},[t("span",{staticClass:"connection-dot"})])}],y=(i(8111),i(7588),i(1701),i(4603),i(7566),i(8721),i(5034));function x(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16)}))}var U={name:"RoomView",data(){const e="https://file2.schoolworks.dev";return{roomCode:this.$route.params.roomId,expiresIn:3600,timerInterval:null,localTimerInterval:null,apiUrl:e,socketUrl:e,socket:null,isSocketConnected:!1,pingInterval:null,lastPongTime:null,selectedFile:null,isUploading:!1,uploadProgress:0,uploadError:"",uploadSuccess:"",files:[],isLoading:!1,userId:`user_${Date.now()}_${Math.floor(1e3*Math.random())}`,hasJoinedRoom:!1,isDragging:!1,isDownloadingAll:!1,notification:{show:!1,message:"",timeout:null,isError:!1},userName:"",isEditingUserName:!1,editUserName:"",previewModal:{show:!1,file:null,previewUrl:"",officeViewerUrl:"",textContent:null,isLoading:!1},qrCodeUrl:"",showQrUserNameModal:!1,showQrCodeModal:!1,qrUserName:"",isQrScanned:!1}},async created(){console.log("API URL:",this.apiUrl),console.log("Socket URL:",this.socketUrl),console.log("URL 쿼리 파라미터:",this.$route.query);const e=new URLSearchParams(window.location.search),t=e.get("userName");console.log("URL에서 직접 추출한 userName:",t);const i="true"===e.get("fromQr");if(i&&!this.isQrScanned)this.isQrScanned=!0,this.showQrUserNameModal=!0,this.qrUserName="",this.userName="";else if(this.userName=t||"내 파일",console.log("최종 설정된 사용자 이름:",this.userName),!t){const e=new URL(window.location.href);e.searchParams.set("userName",this.userName),window.history.replaceState({},"",e.toString())}try{await this.joinOrCreateRoom(),this.startExpiryTimer(),this.loadFiles(),this.connectSocket(),this.generateQrCode(),this.showQrUserNameModal&&this.$nextTick((()=>{this.$refs.qrUserNameInput&&this.$refs.qrUserNameInput.focus()}))}catch(o){console.error("방 참여 오류:",o),this.navigateToHome()}},beforeDestroy(){this.timerInterval&&clearInterval(this.timerInterval),this.localTimerInterval&&clearInterval(this.localTimerInterval),this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),this.socket&&(console.log("컴포넌트 소멸 시 Socket.IO 연결 해제"),this.socket.disconnect(),this.socket=null)},methods:{async joinOrCreateRoom(){try{const e=await p.A.post(`${this.apiUrl}/api/rooms/${this.roomCode}`,{},{withCredentials:!0});this.expiresIn=e.data.expiresIn||3600,this.hasJoinedRoom||(this.showNotification("방에 성공적으로 참여했습니다."),this.hasJoinedRoom=!0)}catch(e){if(!e.response||404!==e.response.status)throw e;if(!/^\d{6}$/.test(this.roomCode))throw e;try{const e=await p.A.post(`${this.apiUrl}/api/rooms`,{roomCode:this.roomCode},{withCredentials:!0});this.expiresIn=e.data.expiresIn||3600,this.showNotification("새 방이 생성되었습니다."),this.hasJoinedRoom=!0}catch(t){throw console.error("방 생성 오류:",t),t}}},async checkRoomStatus(){try{const e=await p.A.get(`${this.apiUrl}/api/rooms/${this.roomCode}/status`,{withCredentials:!0});if(!e.data.active)return this.navigateToHome(),void alert("방이 만료되었습니다.");const t=e.data.expiresIn;this.expiresIn!==t&&(console.log("서버 만료 시간으로 업데이트:",t),this.expiresIn=t,this.updateTimer())}catch(e){console.error("방 상태 확인 실패:",e),this.navigateToHome()}},navigateToHome(){this.$router.push("/").catch((e=>{if("NavigationDuplicated"!==e.name)throw e}))},startExpiryTimer(){this.updateTimer(),this.timerInterval=setInterval((()=>{this.checkRoomStatus()}),5e3)},updateTimer(){this.localTimerInterval&&clearInterval(this.localTimerInterval),this.localTimerInterval=setInterval((()=>{this.expiresIn--,this.expiresIn<=0&&(clearInterval(this.localTimerInterval),clearInterval(this.timerInterval),this.navigateToHome(),alert("방이 만료되었습니다."))}),1e3)},formatTime(e){const t=Math.floor(e/3600),i=Math.floor(e%3600/60),o=e%60;return`${t}:${String(i).padStart(2,"0")}:${String(o).padStart(2,"0")}`},handleFileChange(e){this.selectedFile=e.target.files[0]||null,this.uploadError="",this.uploadSuccess="",this.selectedFile&&(this.showNotification("파일 업로드 중...",1e4),this.uploadFile())},onDragOver(){this.isDragging=!0},onDragLeave(){this.isDragging=!1},onDrop(e){this.isDragging=!1,e.dataTransfer.files.length&&(this.selectedFile=e.dataTransfer.files[0],this.uploadError="",this.uploadSuccess="",this.showNotification("파일 업로드 중...",1e4),this.uploadFile())},openFilePicker(e){e.target.closest(".selected-file")||e.target.closest(".file-select-button")||e.target.closest(".clear-file-button")||this.$refs.fileInput.click()},clearSelectedFile(){this.selectedFile=null,this.$refs.fileInput.value="",this.uploadError="",this.uploadSuccess=""},async uploadFile(){if(!this.selectedFile)return this.uploadError="업로드할 파일을 선택해주세요.",void this.showNotification("업로드할 파일을 선택해주세요.",3e3,!0);this.isUploading=!0,this.uploadProgress=0,this.uploadError="",this.uploadSuccess="";const e=new FormData;e.append("file",this.selectedFile);const t=this.userName||"내 파일";e.append("userName",t),console.log("파일 업로드 시 사용자 이름:",t),this.socket&&this.socket.connected&&e.append("socketId",this.socket.id);const i=new URLSearchParams(window.location.search),o=i.get("userName");if(o!==t){const e=new URL(window.location.href);e.searchParams.set("userName",t),window.history.replaceState({},"",e.toString())}console.log("업로드 시 사용자 이름:",t),console.log("업로드 시작:",{fileName:this.selectedFile.name,fileSize:this.selectedFile.size,fileType:this.selectedFile.type,roomCode:this.roomCode});try{console.log("요청 URL:",`${this.apiUrl}/api/rooms/${this.roomCode}/files`);const t=await p.A.post(`${this.apiUrl}/api/rooms/${this.roomCode}/files`,e,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0,timeout:6e4,onUploadProgress:e=>{const t=Math.round(100*e.loaded/e.total);this.uploadProgress=t,console.log("업로드 진행률:",t+"%")}});console.log("업로드 응답:",t.data);const i=t.data.message||"파일이 성공적으로 업로드되었습니다.";this.uploadSuccess=i,this.uploadProgress=100,this.showNotification(i,3e3),this.selectedFile=null,this.$refs.fileInput&&(this.$refs.fileInput.value="");const o=t.data.file;if(o){o._uniqueKey=x();const e=this.files.findIndex((e=>e.filename===o.filename));-1!==e?(o._uniqueKey=this.files[e]._uniqueKey,this.files.splice(e,1,o)):this.files.push(o),this.files.sort(((e,t)=>t.uploadedAt-e.uploadedAt))}}catch(s){console.error("파일 업로드 오류:",s),s.response?console.error("서버 응답 오류:",{status:s.response.status,data:s.response.data,headers:s.response.headers}):s.request?console.error("요청은 전송됐으나 응답 없음:",s.request):console.error("요청 생성 중 오류:",s.message);const e=s.response?.data?.message||"파일 업로드에 실패했습니다.";this.uploadError=e,this.uploadProgress=0,this.showNotification(e,5e3,!0)}finally{this.isUploading=!1}},async loadFiles(){this.isLoading=!0;try{const e=await p.A.get(`${this.apiUrl}/api/rooms/${this.roomCode}/files`,{withCredentials:!0}),t=e.data.files||[],i=new Map;t.forEach((e=>{(!i.has(e.filename)||e.uploadedAt>i.get(e.filename).uploadedAt)&&i.set(e.filename,e)}));const o=Array.from(i.values());console.log("서버에서 받은 파일 목록:",o),this.files=o.map((e=>(void 0!==e.userName&&null!==e.userName&&""!==e.userName||(console.log("사용자 이름 없음, 기본값 사용:",e.originalName),e.userName="익명"),console.log("파일 정보:",e.originalName,"업로더:",e.userName),{...e,_uniqueKey:x()})))}catch(e){console.error("파일 목록 로드 오류:",e),this.files=[]}finally{this.isLoading=!1}},async downloadFile(e){try{this.showNotification("파일 다운로드 중...",5e3);const t=`${this.apiUrl}/api/rooms/${this.roomCode}/files/download/${e.id}?download=true`;console.log("파일 다운로드 시도:",e.originalName,t);const i=await(0,p.A)({url:t,method:"GET",responseType:"blob",withCredentials:!0,timeout:6e4}),o=e.mimetype||"application/octet-stream",s=new Blob([i.data],{type:o}),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.setAttribute("download",e.originalName),document.body.appendChild(r),r.click(),setTimeout((()=>{window.URL.revokeObjectURL(a),document.body.removeChild(r)}),100),this.showNotification("파일 다운로드가 시작되었습니다.",3e3)}catch(t){console.error("파일 다운로드 오류:",t),console.error("오류 세부 정보:",t.message,t.stack),this.showNotification("파일 다운로드에 실패했습니다.",5e3,!0)}},async deleteFile(e){if(confirm(`파일 "${e.originalName}"을(를) 삭제하시겠습니까?`))try{const t=await p.A.delete(`${this.apiUrl}/api/rooms/${this.roomCode}/files/${e.id}`,{withCredentials:!0}),i=this.files.findIndex((t=>t.id===e.id));-1!==i&&this.files.splice(i,1),this.showNotification(t.data.message||"파일이 삭제되었습니다.")}catch(t){console.error("파일 삭제 오류:",t),this.showNotification("파일 삭제에 실패했습니다.")}},async downloadAllFiles(){if(0!==this.files.length){this.isDownloadingAll=!0,this.showNotification("전체 파일 다운로드 준비 중...",1e4);try{console.log("현재 파일 목록 사용:",this.files);const t=this.files||[];if(0===t.length)return this.showNotification("다운로드할 파일이 없습니다.",3e3,!0),void(this.isDownloadingAll=!1);this.showNotification(`${t.length}개 파일 다운로드 중...`,3e4);let i=0,o=0;for(let s=0;s<t.length;s++){const a=t[s];try{const e=`${this.apiUrl}/api/rooms/${this.roomCode}/files/download/${a.id}`;console.log(`파일 다운로드 시도 (${s+1}/${t.length}):`,a.originalName,e);const o=await(0,p.A)({url:e,method:"GET",responseType:"blob",withCredentials:!0,timeout:6e4}),r=a.mimetype||"application/octet-stream",n=new Blob([o.data],{type:r}),l=window.URL.createObjectURL(n),c=document.createElement("a");c.href=l,c.setAttribute("download",a.originalName),document.body.appendChild(c),c.click(),setTimeout((()=>{window.URL.revokeObjectURL(l),document.body.removeChild(c)}),100),i++,s<t.length-1&&this.showNotification(`파일 다운로드 중... (${i}/${t.length})`,3e4),await new Promise((e=>setTimeout(e,1e3)))}catch(e){console.error(`파일 다운로드 오류 (${a.originalName}):`,e),console.error("오류 세부 정보:",e.message,e.stack),o++}}o>0?this.showNotification(`${i}개 파일 다운로드 완료, ${o}개 실패`,5e3,!0):this.showNotification(`${i}개 파일 다운로드가 완료되었습니다.`,5e3)}catch(t){console.error("전체 파일 다운로드 오류:",t),console.error("오류 세부 정보:",t.message,t.stack),this.showNotification("전체 파일 다운로드에 실패했습니다.",5e3,!0)}finally{this.isDownloadingAll=!1}}else this.showNotification("다운로드할 파일이 없습니다.",3e3,!0)},showNotification(e,t=3e3,i=!1){this.notification.timeout&&clearTimeout(this.notification.timeout),this.notification.message=e,this.notification.show=!0,this.notification.isError=i,this.notification.timeout=setTimeout((()=>{this.notification.show=!1}),t)},formatFileSize(e){if(0===e)return"0 Bytes";const t=1024,i=["Bytes","KB","MB","GB","TB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+i[o]},formatDate(e){if(!e)return"알 수 없음";const t=new Date(e),i=new Date;if(t.toDateString()===i.toDateString())return`오늘 ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`;const o=new Date(i);return o.setDate(i.getDate()-1),t.toDateString()===o.toDateString()?`어제 ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`:`${t.getMonth()+1}/${t.getDate()} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},formatExpiryTime(e){if(!e)return"알 수 없음";const t=new Date(e),i=new Date,o=t-i;if(o<=0)return"만료됨";if(o<36e5){const e=Math.ceil(o/6e4);return`${e}분 후`}if(t.toDateString()===i.toDateString())return`오늘 ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`;const s=new Date(i);return s.setDate(i.getDate()+1),t.toDateString()===s.toDateString()?`내일 ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`:`${t.getMonth()+1}/${t.getDate()} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},isExpiringSoon(e){if(!e.expiresAt)return!1;const t=new Date(e.expiresAt),i=new Date,o=t-i;return o>0&&o<18e5},startEditUserName(){this.editUserName=this.userName,this.isEditingUserName=!0,this.$nextTick((()=>{this.$refs.userNameInput&&this.$refs.userNameInput.focus()}))},saveUserName(){if(this.editUserName.trim()||(this.editUserName="내 파일"),this.userName!==this.editUserName){this.userName=this.editUserName.trim();const e=new URL(window.location.href);e.searchParams.set("userName",this.userName),window.history.replaceState({},"",e.toString()),this.showNotification(`사용자 이름이 '${this.userName}'(으)로 변경되었습니다.`)}this.isEditingUserName=!1},generateQrCode(){try{const e=new URL(window.location.href);e.searchParams.delete("fromQr");const t=new URL(e.toString());t.searchParams.set("fromQr","true"),this.qrCodeUrl=t.toString()}catch(e){console.error("QR 코드 URL 생성 오류:",e)}},showQrCode(){this.showQrCodeModal=!0,this.$nextTick((()=>{this.generateQrCodeInModal()}))},closeQrCodeModal(){this.showQrCodeModal=!1},async generateQrCodeInModal(){try{if(this.$refs.qrcodeLarge){const e=this.$refs.qrcodeLarge;e.innerHTML="";const t=document.createElement("div");t.className="qr-loading",t.textContent="QR 코드 생성 중...",e.appendChild(t);const i=document.createElement("canvas");await this.$qrcode.toCanvas(i,this.qrCodeUrl,{width:400,margin:4,color:{dark:"#000000",light:"#ffffff"},errorCorrectionLevel:"H"}),e.innerHTML="",i.className="qr-code-img-large",e.appendChild(i);const o=document.createElement("div");o.className="qr-url-text",o.textContent=this.qrCodeUrl,e.appendChild(o)}}catch(e){console.error("QR 코드 생성 오류:",e),this.$refs.qrcodeLarge&&(this.$refs.qrcodeLarge.innerHTML='<div class="qr-error">QR 코드 생성 중 오류가 발생했습니다.</div>')}},saveQrUserName(){if(this.qrUserName.trim()){this.userName=this.qrUserName.trim();const e=new URL(window.location.href);e.searchParams.set("userName",this.userName),e.searchParams.delete("fromQr"),window.history.replaceState({},"",e.toString()),this.socket&&this.socket.connected&&this.socket.emit("updateUserName",{roomCode:this.roomCode,userName:this.userName}),this.showQrUserNameModal=!1,this.showNotification(`환영합니다, ${this.userName}님!`,3e3)}else this.qrUserName="방문자"},async previewFile(e){this.previewModal.file=e,this.previewModal.previewUrl="",this.previewModal.officeViewerUrl="",this.previewModal.textContent=null,this.previewModal.isLoading=!0,this.previewModal.show=!0;try{const t=`${this.apiUrl}/api/rooms/${this.roomCode}/files/download/${e.id}`;if(this.isImageFile(e)||this.isPdfFile(e)||this.isVideoFile(e)||this.isAudioFile(e))this.previewModal.previewUrl=t;else if(this.isExcelFile(e)||this.isOfficeFile(e)){const e=encodeURIComponent(`${window.location.origin}${t}`);this.previewModal.officeViewerUrl=`https://docs.google.com/viewer?url=${e}&embedded=true`}else if(this.isTextFile(e)){const e=await(0,p.A)({url:t,method:"GET",responseType:"text",withCredentials:!0});this.previewModal.textContent=e.data}}catch(t){console.error("파일 미리보기 오류:",t),this.showNotification("파일 미리보기를 불러오는데 실패했습니다.",3e3,!0)}finally{this.previewModal.isLoading=!1}},closePreview(){this.previewModal.show=!1,this.previewModal.file=null,this.previewModal.previewUrl="",this.previewModal.textContent=null},isImageFile(e){return e.mimetype&&e.mimetype.startsWith("image/")},isPdfFile(e){return"application/pdf"===e.mimetype},isVideoFile(e){return e.mimetype&&e.mimetype.startsWith("video/")},isAudioFile(e){return e.mimetype&&e.mimetype.startsWith("audio/")},isExcelFile(e){const t=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.oasis.opendocument.spreadsheet"];return t.includes(e.mimetype)||e.originalName&&/\.(xlsx|xls|csv|ods)$/i.test(e.originalName)},isOfficeFile(e){const t=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"];return t.includes(e.mimetype)||e.originalName&&/\.(doc|docx|ppt|pptx)$/i.test(e.originalName)},isTextFile(e){const t=["text/plain","text/html","text/css","text/javascript","application/json","application/xml","application/javascript"];return t.includes(e.mimetype)},connectSocket(){this.socket&&this.socket.connected?console.log("이미 연결된 Socket.IO 재사용"):(this.socket=(0,y.Ay)(this.socketUrl,{reconnection:!0,reconnectionAttempts:20,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:3e4,transports:["websocket","polling"],withCredentials:!0,extraHeaders:{"Access-Control-Allow-Origin":window.location.origin}}),this.socket.on("connect",(()=>{console.log("Socket.IO 연결 성공:",this.socket.id),this.isSocketConnected=!0;const e=new URLSearchParams(window.location.search),t=e.get("userName"),i=t||this.userName||"내 파일";console.log("Socket 연결 시 사용자 이름:",i),this.userName=i,this.socket.emit("joinRoom",this.roomCode,i),this.startPingTimer()})),this.socket.on("joinedRoom",(e=>{console.log("방 참여 확인:",e)})),this.socket.on("reconnect",(e=>{console.log(`Socket.IO 재연결 성공 (시도 ${e}번째)`),this.isSocketConnected=!0;const t=new URLSearchParams(window.location.search),i=t.get("userName"),o=i||this.userName||"내 파일";this.userName=o,this.socket.emit("joinRoom",this.roomCode,o),this.startPingTimer()})),this.socket.on("reconnect_attempt",(e=>{console.log(`Socket.IO 재연결 시도 중 (${e}번째)...`)})),this.socket.on("reconnect_error",(e=>{console.error("Socket.IO 재연결 오류:",e)})),this.socket.on("reconnect_failed",(()=>{console.error("Socket.IO 재연결 실패 (최대 시도 횟수 초과)"),this.isSocketConnected=!1,this.showNotification("서버 연결이 끊겼습니다. 페이지를 새로고침해 주세요.",1e4,!0)})),this.socket.on("fileUploaded",(e=>{if(console.log("새 파일 업로드 알림 수신:",e),e.uploaderId===this.socket.id)return void console.log("내가 업로드한 파일이므로 이벤트 무시");const t={...e.file,_uniqueKey:x()};void 0!==t.userName&&null!==t.userName&&""!==t.userName||(console.log("Socket 이벤트: 사용자 이름 없음, 기본값 사용:",t.originalName),t.userName="익명");const i=this.files.findIndex((e=>e.filename===t.filename));-1!==i?(t._uniqueKey=this.files[i]._uniqueKey,this.files.splice(i,1,t)):(this.files.push(t),this.showNotification(`${t.userName}님이 새 파일을 업로드했습니다.`,3e3)),this.files.sort(((e,t)=>t.uploadedAt-e.uploadedAt))})),this.socket.on("fileDeleted",(e=>{console.log("파일 삭제 알림 수신:",e);const t=this.files.findIndex((t=>t.id&&t.id===e.id||t.filename===e.filename));if(-1!==t){const i=this.files[t];this.files.splice(t,1),"expired"===e.reason?this.showNotification(`"${i.originalName}" 파일이 만료되어 자동으로 삭제되었습니다.`,5e3,!0):this.showNotification("파일이 삭제되었습니다.")}})),this.socket.on("connect_error",(e=>{console.error("Socket.IO 연결 오류:",e),this.isSocketConnected=!1})),this.socket.on("disconnect",(e=>{console.log("Socket.IO 연결 해제:",e),this.isSocketConnected=!1,this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),"io server disconnect"!==e&&"io client disconnect"!==e||this.showNotification("서버와의 연결이 끊겼습니다. 페이지를 새로고침해 주세요.",1e4,!0)})))},startPingTimer(){this.pingInterval&&clearInterval(this.pingInterval),this.pingInterval=setInterval((()=>{this.socket&&this.socket.connected?(console.log("서버에 핑 전송..."),this.socket.emit("ping",(e=>{e&&"ok"===e.status&&(console.log("서버로부터 퐁 수신:",e.time),this.lastPongTime=e.time)}))):(console.warn("소켓이 연결되어 있지 않아 핑을 전송할 수 없습니다."),clearInterval(this.pingInterval),this.pingInterval=null)}),2e4)}}},S=U,_=(0,r.A)(S,C,N,!1,null,"1ff21110",null),k=_.exports;o.Ay.use(d.Ay);const I=[{path:"/",name:"HomeView",component:w},{path:"/room/:roomId",name:"RoomView",component:k},{path:"/:roomId(\\d{6})",name:"DirectRoomView",component:k}],$=new d.Ay({mode:"history",base:"/",routes:I});var M=$,b=i(1910);o.Ay.use(b.Ay);var R=new b.Ay.Store({state:{},getters:{},mutations:{},actions:{},modules:{}}),T=i(1436);o.Ay.config.productionTip=!1,o.Ay.prototype.$qrcode=T,new o.Ay({router:M,store:R,render:e=>e(c)}).$mount("#app")}},t={};function i(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,i),a.exports}i.m=e,function(){var e=[];i.O=function(t,o,s,a){if(!o){var r=1/0;for(d=0;d<e.length;d++){o=e[d][0],s=e[d][1],a=e[d][2];for(var n=!0,l=0;l<o.length;l++)(!1&a||r>=a)&&Object.keys(i.O).every((function(e){return i.O[e](o[l])}))?o.splice(l--,1):(n=!1,a<r&&(r=a));if(n){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[o,s,a]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};i.O.j=function(t){return 0===e[t]};var t=function(t,o){var s,a,r=o[0],n=o[1],l=o[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(s in n)i.o(n,s)&&(i.m[s]=n[s]);if(l)var d=l(i)}for(t&&t(o);c<r.length;c++)a=r[c],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(d)},o=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=i.O(void 0,[504],(function(){return i(8730)}));o=i.O(o)})();
//# sourceMappingURL=app.3616f4ce.js.map